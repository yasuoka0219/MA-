{% extends "ui_base.html" %}
{% block title %}テンプレート一覧 - MA Tool{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-file-text me-2"></i>テンプレート一覧</h2>
    {% if can_edit %}
    <a href="/ui/templates/new" class="btn btn-primary">
        <i class="bi bi-plus"></i> 新規作成
    </a>
    {% endif %}
</div>

<div class="row mb-4">
    <div class="col">
        <div class="btn-group" role="group">
            <a href="/ui/templates" class="btn btn-outline-secondary {% if not status_filter %}active{% endif %}">
                すべて <span class="badge bg-secondary">{{ status_counts.all }}</span>
            </a>
            <a href="/ui/templates?status_filter=draft" class="btn btn-outline-secondary {% if status_filter == 'draft' %}active{% endif %}">
                下書き <span class="badge bg-light text-dark">{{ status_counts.draft }}</span>
            </a>
            <a href="/ui/templates?status_filter=pending" class="btn btn-outline-secondary {% if status_filter == 'pending' %}active{% endif %}">
                承認待ち <span class="badge bg-warning">{{ status_counts.pending }}</span>
            </a>
            <a href="/ui/templates?status_filter=approved" class="btn btn-outline-secondary {% if status_filter == 'approved' %}active{% endif %}">
                承認済み <span class="badge bg-success">{{ status_counts.approved }}</span>
            </a>
            <a href="/ui/templates?status_filter=rejected" class="btn btn-outline-secondary {% if status_filter == 'rejected' %}active{% endif %}">
                却下 <span class="badge bg-danger">{{ status_counts.rejected }}</span>
            </a>
        </div>
    </div>
</div>

<div class="card">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>名前</th>
                    <th>チャネル</th>
                    <th>ステータス</th>
                    <th>更新日時</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for template in templates %}
                <tr>
                    <td>
                        <a href="/ui/templates/{{ template.id }}">{{ template.name }}</a>
                    </td>
                    <td>
                        {% if template.channel_type.value == 'line' %}
                        <span class="badge bg-success"><i class="bi bi-chat-dots"></i> LINE</span>
                        {% else %}
                        <span class="badge bg-primary"><i class="bi bi-envelope"></i> Email</span>
                        {% endif %}
                    </td>
                    <td id="status-{{ template.id }}">
                        {% if template.status.value == 'draft' %}
                        <span class="badge bg-secondary">下書き</span>
                        {% elif template.status.value == 'pending' %}
                        <span class="badge bg-warning">承認待ち</span>
                        {% elif template.status.value == 'approved' %}
                        <span class="badge bg-success">承認済み</span>
                        {% elif template.status.value == 'rejected' %}
                        <span class="badge bg-danger">却下</span>
                        {% endif %}
                    </td>
                    <td>{{ template.updated_at.strftime('%Y-%m-%d %H:%M') if template.updated_at else '-' }}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="/ui/templates/{{ template.id }}" class="btn btn-outline-primary">詳細</a>
                            {% if can_edit and template.status.value != 'approved' %}
                            <a href="/ui/templates/{{ template.id }}/edit" class="btn btn-outline-secondary">編集</a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center text-muted py-4">テンプレートがありません</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
